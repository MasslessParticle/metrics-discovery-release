<%
    nats_ips = link('nats').instances.map { |instance| instance.address }
    nats_port = link('nats').p("nats.port")
    nats_user = link('nats').p("nats.user")
    nats_password = link('nats').p("nats.password")

    nats_hosts = nats_ips.map do |h|
      "nats://#{nats_user}:#{nats_password}@#{h}:#{nats_port}"
    end

    nats_str = nats_hosts.join(",")
%>

processes:
  - name: metrics-discovery-registrar
    executable: /var/vcap/packages/metrics-discovery-registrar/discovery-registrar
    env:
      ROUTES: <%= p("routes") %>
      PUBLISH_INTERVAL: <%= p("publish_interval") %>
      NATS_HOSTS: "<%= nats_str %>"
